'use strict';

var statuses = require('../lib/statuses');
var supported = require('../lib/supported');
var browsers = require('./browsers').browsers;
var versions = require('./browserVersions').browserVersions;

var MATH2LOG = Math.log(2);

function unpackSupport(cipher) {
  // bit flags
  var stats = Object.keys(supported).reduce(function (list, support) {
    if (cipher & supported[support]) list.push(support);
    return list;
  }, []);

  // notes
  var notes = cipher >> 7;
  var notesArray = [];
  while (notes) {
    var note = Math.floor(Math.log(notes) / MATH2LOG) + 1;
    notesArray.unshift('#' + note);
    notes -= Math.pow(2, note - 1);
  }

  return stats.concat(notesArray).join(' ');
}

function unpackFeature(packed) {
  var unpacked = { status: statuses[packed.B], title: packed.C };
  unpacked.stats = Object.keys(packed.A).reduce(function (browserStats, key) {
    var browser = packed.A[key];
    browserStats[browsers[key]] = Object.keys(browser).reduce(function (stats, support) {
      var packedVersions = browser[support].split(' ');
      var unpacked2 = unpackSupport(support);
      packedVersions.forEach(function (v) {
        return stats[versions[v]] = unpacked2;
      });
      return stats;
    }, {});
    return browserStats;
  }, {});
  return unpacked;
}

module.exports = unpackFeature;
module.exports.default = unpackFeature;
//# sourceMappingURL=feature.js.map